<!--
* @Author: 孙永威
* @Date:   2018-10-12
* @Last Modified by: 孙永威
* @Last Modified time: 2018-10-12
-->
<!--
     公共区域缩写词
*leftTopArea(Left Top Area):左上角区域
*caption：说明文字（logo和标题盒子）
*captionTitle(caption Title)：说明文字区标题
*larBox(Login And Register Box):登录和注册盒子
*larBoxTitle(Login And Register Box Title):登录和注册盒子标题
*prompt：提示
-->
<!-- 
    登录缩写词解释
*forgetPwd(Forget Password):忘记密码？
*logonProblem(logon Problem)：登录遇到问题？
*loginBtn(Login Button):登录按钮
 -->
<!-- 
    注册缩写词解释
*registerBtn(Register Button):注册按钮
*rule：协议和规则(在注册按钮之下)
 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login&Register</title>
    <link rel="stylesheet" href="../public/public-css/css-clear.css">
    <link rel="stylesheet" href="../lib/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/login&register.css">
</head>

<body>
    <!-- 右上角LoGO和标题区开始 -->
    <section id="leftTopArea">
        <div class="container">
            <div class="row">
                <div class="caption col-md-12 col-lg-12 col-sm-12">
                    <a href="index.html"><img class="logo img-reposive" src="../public/public-img/LOGO.jpg" alt="LOGO"></a>
                    <div class="captionTitle">
                        <h3>团队管理平台</h3>
                        <h5>软件学院BAR团队</h5>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- 右上角LoGO和标题区开始 -->

    <!-- 登录注册内容区开始 -->
    <section id="larBox">
        <div class="container">
            <!-- 登录注册内容标题区开始 -->
            <div class="row">
                <p class="larBoxTitle col-lg-4 col-md-4 col-sm-4"><span class="bottomLine">登录</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>注册</span></p>
            </div>
            <!-- 登录注册内容标题区结束 -->
            <!-- 登录内容表单区 -->
            <div class="row login" id="login">
                <div class="col-lg-4 col-md-4 col-sm-4">
                    <form class="form-inline">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-user"></i></div>
                                <input type="text" name="account" id="loginAccount" class="form-control" placeholder="请输入账号">
                            </div>
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></div>
                                <input type="password" name="password" id="loginPassword" class="form-control" onkeydown="keyLogin()" placeholder="请输入密码">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- 登录内容提示区 -->
            <div class="row login">
                <div class="col-lg-4 col-md-4 col-sm-4 prompt">
                    <a class="forgetPwd" href="javascript:void(0)">忘记密码？</a>
                    <a class="logonProblem" href="javascript:void(0)">登录遇到问题？</a>
                </div>
            </div>
            <!-- 登录内容登录按钮 -->
            <div class="row login">
                <div class="col-lg-4 col-md-4 col-sm-4">
                    <button class="loginBtn btn-primary center-block" id="loginBtn">登录</button>
                </div>
            </div>
            <!-- ---------------注册和登录分割线------------------------ -->
            <!-- 注册内容表单区 -->
            <div class="row register" id="registerForm" style="display:none;">
                <div class="col-lg-4 col-md-4 col-sm-4">
                    <form class="form-inline">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-user"></i></div>
                                <input type="text" name="account" id="account" class="form-control warnAccount"
                                    placeholder="请输入账号" pattern="^\d{9}$" required="required">
                            </div>
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></div>
                                <input type="password" name="password" id="password" class="form-control warnPassword"
                                    placeholder="请输入10~16位密码" pattern="(?!^\\d+$)(?!^[a-zA-Z]+$)(?!^[_#@]+$).{10,16}"
                                    required="required">
                            </div>
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></div>
                                <input type="password" name="againpassword" id="againPassword" class="form-control warnAgainPassword"
                                    placeholder="请再次输入密码" pattern="(?!^\\d+$)(?!^[a-zA-Z]+$)(?!^[_#@]+$).{10,16}"
                                    required="required">
                            </div>
                            <div class="input-group">
                                <div class="input-group-addon"><i class="glyphicon glyphicon-phone"></i></div>
                                <input type="text" name="phoneNumber" id="phoneNumber" class="form-control warnPhoneNumber" onkeydown="keyRegister()" placeholder="请输入您的手机号" pattern="^1(3|4|5|7|8)\d{9}$" required="required">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!-- 注册内容注册按钮 -->
            <div class="row register" style="display:none;">
                <div class="col-lg-4 col-md-4 col-sm-4">
                    <button class="registerBtn btn-primary center-block" id="registerBtn">注册</button>
                </div>
            </div>
            <!-- 注册底部内容提示区 -->
            <div class="row register" style="display:none;">
                <div class="col-lg-4 col-md-4 col-sm-4 prompt">
                    <p class="rule" href="javascript:void(0)">点击 “注册” 即表示您同意并愿意遵守团队管理平台</p>
                    <p class="rule"><a href="javascript:void(0)">用户协议</a>&nbsp;和&nbsp;<a href="javascript:void(0)">隐私政策</a>
                        。</p>
                </div>
            </div>
        </div>
    </section>
    <!-- 登录注册内容区结束 -->
</body>
<script src="../lib/jquery-2.1.4/jquery.min.js"></script>
<script src="../lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="../js/login&register.js"></script>
<script>
    //注册页面的交互
    $(function () {
        //1.正则表达式，用户输入的数据是否合法
        //正则表达式————验证账号格式
        var isUserAccount = /^\d{9}$/;
        //正则表达式————密码是否为10~16位
        var isUserPassword = /(?!^\\d+$)(?!^[a-zA-Z]+$)(?!^[_#@]+$).{10,16}/;
        //正则表达式————判断手机号格式
        var isUserPhoneNumber = /^1(3|4|5|7|8)\d{9}$/;

        //总体判断，当输入正确，阀门值为true，否则为false
        var flag = true;

        //2.获取文本框值
        //判断账号
        $('#larBox #registerForm #account').on('blur', function () {
            if (isUserAccount.test($('#larBox #registerForm #account').val())) {
                $('#larBox #registerForm #account').attr('class', 'form-control');
                flag = true;
            } else {
                $('#larBox #registerForm #account').attr('class', 'form-control warnAccount');
                flag = false;
            }
        });
        //判断初次密码，密码的任何改变都以初次输入的密码为准
        $('#larBox #registerForm #password').on('blur', function () {
            var userPassword = isUserPassword.test($('#larBox #registerForm #password').val());
            //如果再次输入密码框为空，则只判断格式
            if ($('#larBox #registerForm #againPassword').val() == '') {
                if (userPassword) {
                    $('#larBox #registerForm #password').attr('class', 'form-control');
                    flag = true;
                } else {
                    $('#larBox #registerForm #password').attr('class', 'form-control warnPassword');
                    flag = false;
                }
            } else {
                //如果再次输入密码框不为空，判断二者是否相等
                var againUserPasword = isUserPassword.test($('#larBox #registerForm #againPassword').val());
                if ($('#larBox #registerForm #password').val() === $(
                        '#larBox #registerForm #againPassword')
                    .val() && userPassword && againUserPasword) {
                    $('#larBox #registerForm #password').attr('class', 'form-control');
                    $('#larBox #registerForm #againPassword').attr('class', 'form-control');
                    flag = true;
                } else {
                    $('#larBox #registerForm #againPassword').attr('class', 'form-control warnPassword');
                    flag = false;
                }
            }
        });
        //判断两次输入的密码是否一致
        $('#larBox #registerForm #againPassword').on('blur', function () {
            var againUserPasword = isUserPassword.test($('#larBox #registerForm #againPassword').val());
            if ($('#larBox #registerForm #againPassword').val() === $('#larBox #registerForm #password')
                .val() && againUserPasword) {
                $('#larBox #registerForm #againPassword').attr('class', 'form-control');
                flag = true;
            } else {
                $('#larBox #registerForm #againPassword').attr('class', 'form-control warnPassword');
                flag = false;
            }
        });
        //判断手机号格式是否正确
        $('#larBox #registerForm #phoneNumber').on('blur', function () {
            var userPhoneNumber = isUserPhoneNumber.test($('#larBox #registerForm #phoneNumber').val());
            if (userPhoneNumber) {
                $('#larBox #registerForm #phoneNumber').attr('class', 'form-control');
                flag = true;
            } else {
                $('#larBox #registerForm #phoneNumber').attr('class', 'form-control warnPhoneNumber');
                flag = false;
            }
        });

        //3.防止出现文本出错但未修改情况，以及文本为空，
        //发送ajax注册请求
        $('#larBox #registerBtn').on('click', function () {
            if (!flag) {
                alert('注册文本有误，请修改！');
                return false;
            } else if (flag) {
                if ($('#larBox #registerForm #account').val() == '' || $(
                        '#larBox #registerForm #password').val() == '' || $(
                        '#larBox #registerForm #againPassword').val() == '' || $(
                        '#larBox #registerForm #phoneNumber').val() == '') {
                    alert('文本不能为空！');
                    return false;
                } else {
                    $.ajax({
                        async: true,
                        beforeSend: function () {
                            $('#larBox #registerBtn').html('注册中···');
                        },
                        complete: function () {
                            $('#larBox #registerBtn').html('注册');
                        },
                        type: "POST",
                        url: "",
                        dataType: "json",
                        data: {
                            account: $('#larBox #registerForm #account').val(),
                            password: $('#larBox #registerForm #password').val(),
                            rePassword: $('#larBox #registerForm #againPassword').val(),
                            phone: $('#larBox #registerForm #phoneNumber').val()
                        },
                        success: function (data) {
                            var data = JSON.stringify(data);
                            data = JSON.parse(data);
                            if (data.status == 'ok') {
                                alert(data.msg);
                                window.location = 'login&register.html';
                            } else {
                                alert(data.msg);
                                return false;
                            }
                        },
                        error: function (data) {
                            var data = JSON.stringify(data);
                            data = JSON.parse(data);
                            console.log(data.status, data.statusText);
                            return false;
                        }
                    });
                }
            }
        });
    });

    //登录页面的交互
    $(function () {
        $('#larBox #loginBtn').on('click', function () {
            if ($('#larBox #login #loginAccount').val() == '' || $('#larBox #login #loginPassword').val() ==
                '') {
                alert('账号或密码不能为空！');
            } else {
                $.ajax({
                    async: true,
                    beforeSend: function () {
                        $('#larBox #loginBtn').html('登录中···');
                    },
                    complete: function () {
                        $('#larBox #loginBtn').html('登录');
                    },
                    type: "POST",
                    url: "",
                    dataType: "json",
                    data: {
                        account: $('#larBox #login #loginAccount').val(),
                        pwd: $('#larBox #login #loginPassword').val()
                    },
                    success: function (data) {
                        var data = JSON.stringify(data);
                        data = JSON.parse(data);
                        if (data.status == 'ok') {
                            window.location = 'index.html';
                        } else {
                            alert(data.msg);
                            return false;
                        }
                    },
                    error: function (data) {
                        var data = JSON.stringify(data);
                        data = JSON.parse(data);
                        console.log(data.status, data.msg);
                        return false;
                    }
                });
            }
        });
    });
    //在密码框点击回车键，调用登录事件
    function keyLogin() {
        if (event.keyCode == 13) { //回车键的键值为13
            $('#larBox #loginBtn').click(); //调用搜索按钮的登录事件
        }
    }
    //在注册手机号框点击回车键，调用注册事件
    function keyRegister() {
        if (event.keyCode == 13) { //回车键的键值为13
            $('#larBox #registerBtn').click(); //调用搜索按钮的登录事件
        }
    }
</script>

</html>