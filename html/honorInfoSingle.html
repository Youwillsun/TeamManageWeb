<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>honorInformationAll</title>
    <link rel="stylesheet" href="../public/public-css/css-clear.css">
    <link rel="stylesheet" href="../lib/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../lib/animate.css-3.5.0/animate.min.css">
    <link rel="stylesheet" href="../public/public-header/header.css">
    <link rel="stylesheet" href="../css/teamhonor.css">
    <link rel="stylesheet" href="../public/public-slider/slider.css">
    <link rel="stylesheet" href="../public/public-memberModule/memberInformationAll.css">
    <link rel="stylesheet" href="../public/public-footer/footer.css">
</head>

<body>
    <!--头部区域-->
    <header id="header"></header>
    <!--头部区域-->

    <!--团队荣耀-->
    <section id="taemHonor" class="wow fadeIn">
        <div class="container">
            <div class="title">
                <h3>BAR团队荣耀</h3>
            </div>
            <div id="main_ad" class="carousel slide" data-ride="carousel">

            </div>
        </div>
    </section>
    <!--团队荣耀-->

    <!--荣耀名称-->
    <section id="honorName" class="wow fadeIn">
        <div class="container">
            <div class="allInformation col-md-8 col-md-offset-2 col-sm-12">
                <div class="title">
                    <h3>荣耀名称：企业开发平台</h3>
                </div>
                <div class="slogan col-md-12 col-sm-12">
                    <span class="pull-left">所属团队:天南团</span>
                    <span class="pull-right">指导教师：XXXXX</span>
                </div>
                <div class="content col-md-12">
                    <div class="honorInstruct">荣耀简介</div>
                    <div class="input">
                        <div class="word"></div>
                        <div class="introduceTextBox">
                            <p class="introduceText">
                                燕子去了，有再来的时候；杨柳枯了，有再青的时候；桃花谢了，有再开的时 候。但是，聪明的，你告诉我，我们的日子为什么一去不复返呢？——是有人偷了他
                                们罢：那是谁？又藏在何处呢？是他们自己逃走了罢——如今又到了哪里呢？我不知道他们给了我多少日子，但我的手确乎是渐渐空虚了。在默默里算着，八千多日子已经从我手中溜去，像针尖上一滴水滴在大海里，我的日子滴在时间的流里，没有声音，也没有影子。我不禁头涔涔而泪潸潸了。去的尽管去了，来的尽管来着；去来的中间，又怎样地匆匆呢？早上我起来的时候，小屋里射进两三方斜斜的太阳。太阳他有脚啊，轻轻悄悄地挪移了；我也茫茫然跟着旋转。于是——洗手的时候，日子从水盆里过去；吃饭的时候，日子从饭碗里过去；默默时，便从凝然的双眼前过去。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--荣耀名称-->

    <!--参与的本团队成员-->
    <section id="parTeammember" class="wow fadeIn">
        <div class="title">
            <span>参与人员</span>
            <p>本团队成员</p>
        </div>
        <div id="memberContent"></div>
    </section>
    <!--参与的本团队成员-->

    <!--参与的非本团队成员-->
    <section id="parNonteammember" class="wow fadeIn">
        <div class="title">非本团队成员</div>
        <div class="memberNameBox">
            <p class="memberNameText">
                燕子去了，有再来的时候；杨柳枯了，有再青的时候；桃花谢了，有再开的时 候。但是，聪明的，你告诉我，我们的日子为什么一去不复返呢？——是有人偷了他
                们罢：那是谁？又藏在何处呢？是他们自己逃走了罢——如今又到了哪里呢？我不知道他们给了我多少日子，但我的手确乎是渐渐空虚了。在默默里算着，八千多日子已经从我手中溜去，像针尖上一滴水滴在大海里，我的日子滴在时间的流里，没有声音，也没有影子。
            </p>
        </div>
        <div class="worksAuditing">
            <!--作品审核-->
            <div class="container">
                <div class="col-md-1 col-sm-2"></div>
                <div class="internLink col-md-3 col-sm-2">网络链接：<strong>www.barteam.cn</strong> </div>
                <div class="col-md-1 col-sm-1"></div>
                <div class="col-md-2 col-sm-2 auditing">
                    <p>作品审核：已通过</p>
                    <button class="btn btn-info">荣耀资料下载</button></a>
                </div>
                <div class="col-md-1 col-sm-1"></div>
                <div class="time col-md-3 col-sm-2">上传时间：2018年9月10日</div>
            </div>
        </div>
    </section>
    <!--参与的非本团队成员-->

    <!--脚注区域-->
    <footer id="footer"></footer>
    <!--脚注区域-->
</body>
<script src="../lib/jquery-2.1.4/jquery.min.js"></script>
<script src="../lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="../lib/wow-1.1.2/wow.min.js"></script>
<script src="../public/public-header/header.js"></script>
<script src="../public/public-slider/slider.js"></script>
<script src="../public/public-memberModule/memberInformationAll.js"></script>
<script src="../public/public-footer/footer.js"></script>
<script>
    //为了保持页面完整性，测试需要注释
    slider('#main_ad', 1);
    memberInformation("#memberContent", 5);

    $(function () {
        //获取地址中的index值
        var honorId = decodeURI(window.location.href).split('=')[1];
        //判断index值是否为空，为空则加载1号团队
        if (honorId == null) {
            honorId = 1;
        }
        //发送ajax，传输honorId的值
        $.ajax({
            async: true,
            beforeSend: function () {},
            complete: function () {},
            type: "POST",
            url: "/SingleHonor/GetSingleHonor",
            dataType: "json",
            data: {
                HonorId: honorId
            },
            success: function (data) {
                var data = JSON.stringify(data);
                data = JSON.parse(data);
                //传入数据
                init(data);
            },
            error: function (data) {
                console.log(data.status, data.statusText);
            }
        });

        //单独封装的时间转化函数
        function timeChage(time) {
            //把时间转换一下格式，年 月 日
            var date = new Date(time);
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var timeEnd = year + '年' + month + '月' + day + '日';
            return timeEnd;
        }
        //封装DOM操作
        function init(data) {
            honorInfoSingle.singleData(data);
            honorInfoSingle.honorSingleSlider(data);
            honorInfoSingle.personalIntroduce(data);
            honorInfoSingle.eventClick();
        }
        var honorInfoSingle = (function () {
            //单个的赋值操作
            function singleData(data) {
                //改变荣耀的标题团队
                $('#taemHonor .title h3').text(data.singleHonor.teamName);
                //改变荣耀名称
                $('#honorName .allInformation .title h3').text("荣耀名称：" + data.singleHonor.honorName)
                //改变所属团队
                $('#honorName .allInformation .slogan span').eq(0).text("所属团队：" + data.singleHonor.teamName);
                //改变指导教师
                $('#honorName .allInformation .slogan span').eq(1).text("指导教师：" + data.singleHonor.guidTeacher);
                //改变荣耀简介
                $('#honorName .allInformation .content .input .introduceTextBox .introduceText').text(
                    data.singleHonor.honorIntroduce);
                //改变非本团队成员
                $('#parNonteammember .memberNameBox .memberNameText').text(data.singleHonor.unperHonorName);
                //改变网络连接
                $('#parNonteammember .worksAuditing .internLink strong').text(data.singleHonor.netLocation);
                //网络连接点击时，需要可以跳转到相应网页
                $('#parNonteammember .worksAuditing .internLink strong').on('click', function () {
                    //获取到对应的连接
                    var link = $('#parNonteammember .worksAuditing .internLink strong').text();
                    //判断前面的字符，是否符合格式
                    if (link.substring(0, 7) == 'http://') {
                        window.location.href = link;
                    } else if (link.substring(0, 8) == 'https://') {
                        window.location.href = link;
                    } else if (link.substring(0, 4) == 'www.') {
                        window.location.href = 'http://' + link;
                    } else {
                        alert('地址格式有误！');
                    }
                });
                //改变作品审核
                $('#parNonteammember .worksAuditing .auditing p').text("作品审核：" + data.singleHonor.check);
                //作品审核直接关系着下载按钮的状态，未审核，则设置按钮禁用，审核则不禁用且拿到下载地址
                if (data.singleHonor.check == '未审核') {
                    $('#parNonteammember .worksAuditing .auditing button').attr('class',
                        'btn btn-info disabled');
                }
                if (data.singleHonor.check == '已审核') {
                    $('#parNonteammember .worksAuditing .auditing button').on('click', function () {
                        //下载文件的AJAX，传输一个HonorID
                        $.ajax({
                            async: true,
                            beforeSend: function () {},
                            complete: function () {},
                            type: "POST",
                            url: "/SingleHonor/DownLoadFile",
                            dataType: "json",
                            data: {
                                HonorId: honorId
                            },
                            success: function (data) {
                                var data = JSON.stringify(data);
                                data = JSON.parse(data);
                                if(data.status == 'ok'){
                                    alert('文件已下载至D盘根目录');
                                }else{
                                    alert(data.result);
                                }
                            },
                            error: function (data) {
                                console.log(data.status, data.statusText);
                            }
                        });
                    });
                }
                //改变上传时间
                var honorSubmit = timeChage(data.singleHonor.honorSubmit);
                $('#parNonteammember .worksAuditing .time').text("上传时间：" + honorSubmit);
            }
            //轮播图操作
            function honorSingleSlider(data) {
                //把轮播图转化成json
                var honorSliderJson = JSON.parse(data.singleHonor.honorSlider);
                //获取到服务器json数组中的IndexSlider长度
                var sliderNum = honorSliderJson.length;
                //如果获取个数为0，则sliderNum = 1，保证创建一个
                if (sliderNum < 1) {
                    slider('#main_ad', 1);
                    return false;
                } else {
                    //创建相应个数轮播图
                    slider('#main_ad', sliderNum);
                    //把获取到的值，替换img.src
                    var img = $('#main_ad .item img');
                    for (var k = 0; k < sliderNum; k++) {
                        img[k].src = honorSliderJson[k].image;
                    }
                }
            }
            //封装个人简介部分
            function personalIntroduce(data) {
                //获取返回数据的信息长度，然后自动创建相应个数
                var memberIntroduceNum = data.singlePerson.length;
                if (memberIntroduceNum <= 0) {
                    return false;
                } else {
                    memberInformation("#memberContent", memberIntroduceNum);
                }
                //获取到第一排信息列外围盒子
                var information = $(
                    '#memberContent #memberIntroduce .memberIntroduceBox .memberContent .information'
                );
                //利用循环，动态改变页面内的值
                for (var i = 0; i < memberIntroduceNum; i++) {
                    //判断个人信息id是否为空
                    if(data.singlePerson[i].singlePersonId == null){
                        alert('个人信息ID返回有误');
                    }else{
                        //设置个人信息Box，id值
                        $('#memberContent #memberIntroduce .memberIntroduceBox .memberLogo').eq(i).attr('index', data.singlePerson[i].singlePersonId);
                        //设置个人信息头像图片地址
                        $('#memberContent #memberIntroduce .memberIntroduceBox .memberLogo .memberLogoImg')[i].src = data.singlePerson[i].perLogo;
                        //判断姓名是否为空
                        if (data.singlePerson[i].perName == null) {
                            data.singlePerson[i].perName = '暂无';
                        }
                        information.eq(i).find('.memberName').text("姓名：" + data.singlePerson[i].perName);
                        //判断姓别是否为空
                        if (data.singlePerson[i].gender == null) {
                            data.singlePerson[i].gender = '暂无';
                        }
                        information.eq(i).find('.memberTeacher').text("性别：" + data.singlePerson[i].gender);
                        if (data.singlePerson[i].position == null) {
                            data.singlePerson[i].position = '暂无';
                        }
                        information.eq(i).find('.memberHeader').text("团队职务：" + data.singlePerson[i].position);
                        //判断联系方式是否为空
                        if (data.singlePerson[i].phone == null) {
                            data.singlePerson[i].phone = '暂无';
                        }
                        information.eq(i).find('.establishTime').text("联系方式：" + data.singlePerson[i].phone);
                        //判断个人简介是否为空
                        if (data.singlePerson[i].perIntroduce == null) {
                            data.singlePerson[i].perIntroduce = '这个人什么都没有留下!';
                        }
                        $(
                            '#memberContent #memberIntroduce .memberIntroduceBox .memberContent .introduce .introduceTextarea'
                        ).eq(i).text(data.singlePerson[i].perIntroduce);
                        //判断兴趣爱好是否为空
                        if (data.singlePerson[i].perHobby == null) {
                            data.singlePerson[i].perHobby = '这个人好像没什么爱好!';
                        }
                        $(
                            '#memberContent #memberIntroduce .memberIntroduceBox .memberContent .leading .leadingTextarea'
                        ).eq(i).text(data.singlePerson[i].perHobby);
                    }
                }
            }

            function eventClick() {
                //点击个人简介头像，向另一个页面传输id值
                $('#memberContent #memberIntroduce .memberIntroduceBox .memberLogo a').on('click',
                    function () {
                        var index = $(this).parent().attr('index');
                        var url = '/PersonShow/Index';
                        window.location.href = url + '?index=' + index;
                    });
            }
            return {
                singleData: singleData,
                honorSingleSlider: honorSingleSlider,
                personalIntroduce: personalIntroduce,
                eventClick: eventClick
            }
        })();
    });
</script>

</html>